@model FootballApiResponse[];

@{
    ViewData["Title"] = "Football Matches - NATIVE STATS";
}

<slide-toggle></slide-toggle>
<p class="disclaimer">* Odds are mock data randomly generated.</p>

<div id="competitions-container">
    @foreach (var competition in Model)
    {
        <partial name="_CompetitionPartial" model="competition" />
    }
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const toggle = document.querySelector("slide-toggle");
        const container = document.getElementById("competitions-container");

        toggle.addEventListener("toggle-change", (event) => {
            const isRecent = event.detail;

            const competitions = container.querySelectorAll(".competition");
            competitions.forEach(competition => {
                const competitionId = competition.dataset.competitionId;

                fetch(`/Home/GetCompetitionPartial?competitionId=${competitionId}&isRecent=${isRecent}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Failed to load competition partial view");
                        }
                        return response.text(); 
                    })
                    .then(html => {
                        competition.outerHTML = html; 
                    })
                    .catch(error => {
                        console.error(error);
                    });
            });
        });
    });
</script>

<script src="~/js/slide-toggle.js" async></script>
